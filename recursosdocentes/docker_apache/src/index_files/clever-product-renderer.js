define(['jquery','mage/translate','Magento_Catalog/js/price-utils','underscore','jquery/ui','jquery/jquery.parsequery',"fotoramaVideoEvents","Magento_Swatches/js/swatch-renderer",'jQueryLibMin'],function($,$t,priceUtils){'use strict';function parseHref(href){var a=document.createElement('a');a.href=href;return a;}
function parseURL(href,forceVideo){var id,type,ampersandPosition,vimeoRegex;function _getYoutubeId(srcid){if(srcid){ampersandPosition=srcid.indexOf('&');if(ampersandPosition===-1){return srcid;}
srcid=srcid.substring(0,ampersandPosition);}
return srcid;}
if(typeof href!=='string'){return href;}
href=parseHref(href);if(href.host.match(/youtube\.com/)&&href.search){id=href.search.split('v=')[1];if(id){id=_getYoutubeId(id);type='youtube';}}else if(href.host.match(/youtube\.com|youtu\.be/)){id=href.pathname.replace(/^\/(embed\/|v\/)?/,'').replace(/\/.*/,'');type='youtube';}else if(href.host.match(/vimeo\.com/)){type='vimeo';vimeoRegex=new RegExp(['https?:\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)','?|groups\\/([^\\/]*)\\/videos\\/|album\\/(\\d+)\\/video\\/|video\\/|)(\\d+)(?:$|\\/|\\?)'].join(''));id=href.href.match(vimeoRegex)[3];}
if((!id||!type)&&forceVideo){id=href.href;type='custom';}
return id?{id:id,type:type,s:href.search.replace(/^\?/,'')}:false;}
$.widget('cleversoft.cleverBaseApllyImageAndVideoEvent',{options:{class:{sticky_gallery_content:'.gallery-sticky2',thumb_content:'.gallery-sticky2-image-thumb-col',image_content:'.gallery-sticky2-image-col',image_wrapper:'.gallery-sticky2-image-wrapper',video_wrapper:'.gallery-sticky2-video-wrapper'}},_create:function(){console.log('run cleverBaseApllyImageAndVideoEvent');var gallery_content=$(this.options.class.sticky_gallery_content);var thumb_content=gallery_content.find(this.options.class.thumb_content);var image_content=gallery_content.find(this.options.class.image_content);image_content.find(this.options.class.video_wrapper+" a").click(function(event){event.preventDefault();});image_content.find(this.options.class.video_wrapper).click(function(){var url=$(this).data('media-url');var video_data=parseURL(url);$(this).data('related','0').data('loop','0').data('responsive',false).data('type',video_data.type).data('code',video_data.id).data('width',$(this).width()).data('height',$(this).height());$(this).productVideoLoader();});}});$.widget('cleversoft.cleverBaseUpdateImageAndVideo',{options:{images:{},class:{sticky_gallery_content:'.gallery-sticky2',thumb_content:'.gallery-sticky2-image-thumb-col',image_content:'.gallery-sticky2-image-col',image_wrapper:'.gallery-sticky2-image-wrapper',video_wrapper:'.gallery-sticky2-video-wrapper',}},_create:function(){var galerry_data=this.options.images;var gallery_content=$(this.options.class.sticky_gallery_content);var thumb_content=gallery_content.find(this.options.class.thumb_content);var image_content=gallery_content.find(this.options.class.image_content);var html='';$.each(galerry_data,function(key,item){if(item.media_type=='external-video'){html+='<div class="gallery-sticky2-video-wrapper" data-media-type="external-video" data-media-url="'+item.video_url+'">';}else{html+='<div class="gallery-sticky2-image-wrapper">';}
html+='<a href="'+item.full+'">';html+='<img src="'+item.img+'">';html+='</a>';html+='</div>';});image_content.html(html);$.cleversoft.cleverBaseApllyImageAndVideoEvent(this.options);}});$.widget('mage.cleverSwatchRendererTooltip',$.mage.SwatchRendererTooltip,{});$.widget('mage.cleverSwatchRenderer',$.mage.SwatchRenderer,{options:{stickyClass:false,onlyMainImg:false,equalHeightConfig:false},_init:function(){var $widget=this;var $_init=this._super();$.when.apply(null,$_init).done(function(){if($('.gallery-placeholder').size()==0)$widget.element.find("."+$widget.options.classes.attributeClass).slice(1).css({'height':0,'overflow':'hidden'});if($widget.options.equalHeightConfig){if($widget.element.closest('.trigger-equal-height').length>0){$widget._updateHeightOnCatalogListing($widget.element.closest('.trigger-equal-height'));}}});if($widget.element.find("."+$widget.options.classes.attributeClass).length>0){$widget.element.closest('.product-item-info').find('.action.tocart span').text($t('Select Options'));}},_updateHeightOnCatalogListing:function($selector){if($($selector).length>0){$($selector).attr('data-mage-init',JSON.stringify({'equalHeight':{'target':' .product-item-info'}})).trigger('contentUpdated');}},_RenderFormInput:function(config){return'<input class="'+this.options.classes.attributeInput+' super-attribute-select" '+'name="super_attribute['+config.id+']" '+'type="text" '+'value="" '+'data-selector="super_attribute['+config.id+']" '+'data-validate="{required:true}" '+'aria-required="true" '+'aria-invalid="true" '+'style="visibility: hidden; position:absolute; left:-1000px">';},_UpdatePrice:function(){var $widget=this,$product=$widget.element.parents($widget.options.selectorProduct),$productPrice=$product.find(this.options.selectorProductPrice),options=_.object(_.keys($widget.optionsMap),{}),result;$widget.element.find('.'+$widget.options.classes.attributeClass+'[option-selected]').each(function(){var attributeId=$(this).attr('attribute-id');options[attributeId]=$(this).attr('option-selected');});$.each(options,function(key,val){if(!val){delete options[key];}});result=$widget.options.jsonConfig.optionPrices[_.findKey($widget.options.jsonConfig.index,options)];if(typeof $productPrice!='undefined'&&$productPrice.priceBox){$productPrice.trigger('updatePrice',{'prices':$widget._getPrices(result,$productPrice.priceBox('option').prices)});}
var productId=$product.find("input[name='product']").attr('value');if(typeof result!='undefined'&&result.oldPrice.amount!==result.finalPrice.amount){$(this.options.slyOldPriceSelector+':has(#old-price-'+productId+')').show();}else{$(this.options.slyOldPriceSelector+':has(#old-price-'+productId+')').hide();}
var priceFormat={currency:"EUR",pattern:"%s â‚¬",style:"currency"};$('#product-price-'+productId+' .price').html(priceUtils.formatPrice(result.finalPrice.amount,priceFormat));$('#old-price-'+productId+' .price').html(priceUtils.formatPrice(result.oldPrice.amount,priceFormat));if(result.finalPrice.amount<result.oldPrice.amount){var _savingPercent=100-Math.round((result.finalPrice.amount / result.oldPrice.amount)*100);$('#product-price-'+productId+' .price').closest('.product-info-price').find('.discount span:first-child').html(' - '+_savingPercent+' %');$product.find('.discount span:first-child').html(' - '+_savingPercent+' %');}
var $show=true;var attId=null;var optionSel=null;var $options=$widget.element.find("."+$widget.options.classes.attributeClass);$options.each(function(){if($(this).find('.'+$widget.options.classes.optionClass+'.selected').length==0){$show=false;return false;}
attId=$(this).attr('attribute-id');optionSel=$(this).attr('option-selected');})
if($show){$widget.element.closest('.product-item-info').find('.action.tocart.product-view span').text($t('View product'));var original_url=$widget.element.closest('.product-item-info').find('.action.tocart.product-view').attr('original-url');var finalUrl=original_url+'#'+attId+'='+optionSel;$widget.element.closest('.product-item-info').find('.action.tocart.product-view a').attr('href',finalUrl);}
if($widget.options.stickyClass){var $_contaniner=$('.'+$widget.options.stickyClass);if($_contaniner.length>0){$_contaniner.find('div[data-role="priceBox"]').html($productPrice.html());}}},_EnableProductMediaLoader:function($this){var $widget=this;if($widget.element.closest('.product-view-bg').find('.gallery-placeholder').length){$widget.element.closest('.product-view-bg').find('.gallery-placeholder').addClass($widget.options.classes.loader);}else if($widget.element.closest('.product-item-info').find('.zoo-product-image').length){$widget.element.closest('.product-item-info').find('.zoo-product-image').addClass($widget.options.classes.loader);}},_DisableProductMediaLoader:function($this){var $widget=this;if($widget.element.closest('.product-view-bg').find('.gallery-placeholder').length){$widget.element.closest('.product-view-bg').find('.gallery-placeholder').removeClass($widget.options.classes.loader);}else if($widget.element.closest('.product-item-info').find('.zoo-product-image').length){$widget.element.closest('.product-item-info').find('.zoo-product-image').removeClass($widget.options.classes.loader);}},_ProductMediaCallback:function($this,response){var isProductViewExist=$('.gallery-placeholder').size()>0,$main=isProductViewExist?$this.parents('.column.main'):$this.parents('.product-item-info'),$widget=this,images=[],support=function(e){return e.hasOwnProperty('large')&&e.hasOwnProperty('medium')&&e.hasOwnProperty('small');};if($main.length<=0){$main=$this.closest('.product-view-bg');}
if(_.size($widget)<1||!support(response)){var $promise=this.updateBaseImage(this.options.mediaGalleryInitial,$main,isProductViewExist);$.when.apply(null,$promise).done($widget.changeButtonCartText());return;}
images.push({media_type:response.media_type,full:response.large,img:response.medium,thumb:response.small,isMain:true,video_url:response.video_url});if(response.hasOwnProperty('gallery')){$.each(response.gallery,function(){if(!support(this)||response.large===this.large){return;}
images.push({media_type:this.media_type,full:this.large,img:this.medium,thumb:this.small,video_url:this.video_url});});}
var $promise=this.updateBaseImage(images,$main,isProductViewExist);$.when.apply(null,$promise).done($widget.changeButtonCartText());},changeButtonCartText:function(){var $widget=this;var $options=$widget.element.find("."+$widget.options.classes.attributeClass);var $show=true;var attId=null;var optionSel=null;$options.each(function(){if($(this).find('.'+$widget.options.classes.optionClass+'.selected').length==0){$show=false;return false;}
attId=$(this).attr('attribute-id');optionSel=$(this).attr('option-selected');})},updateBaseImage:function(images,context,isProductViewExist){var justAnImage=images[0],updateImg,imagesToUpdate,gallery=context.find(this.options.mediaGallerySelector).data('gallery'),item;if(typeof(gallery)==='undefined'){gallery=context.find('.quickview-gallery-placeholder').data('gallery');}
if(isProductViewExist){if(typeof(gallery)!='undefined'&&gallery!=null){imagesToUpdate=images.length?this._setImageType($.extend(true,[],images)):[];if(this.options.onlyMainImg){updateImg=imagesToUpdate.filter(function(img){return img.isMain;});item=updateImg.length?updateImg[0]:imagesToUpdate[0];gallery.updateDataByIndex(0,item);gallery.seek(1);}else{gallery.updateData(imagesToUpdate);if(typeof AddFotoramaVideoEvents!=='undefined'&&$.isFunction(typeof AddFotoramaVideoEvents)){$(this.options.mediaGallerySelector).AddFotoramaVideoEvents();}}}}else if(justAnImage&&justAnImage.img){var $img=justAnImage.img;$.each(justAnImage,function(i,val){if($.type(val)==="string"){var indexOfImg=val.indexOf(context.find('.product-image-photo').data('size'));if(indexOfImg>0){var $img=val;justAnImage.finalImg=val;return $img;}}});if(justAnImage.finalImg===undefined||justAnImage.finalImg===null){justAnImage.finalImg=justAnImage.img;}
if(justAnImage.finalImg.replace(/^.*[\\\/]/,'')==='transparent.gif'){justAnImage.finalImg=context.find('.product-image-photo').attr('data-img');}
context.find('.product-image-photo').attr('srcset',justAnImage.finalImg).attr('src',justAnImage.finalImg).attr('data-src',justAnImage.finalImg).waitForImages({finished:function(){},each:function(){},waitForAll:true}).done(function(){$(this).closest('.trigger-equal-height').attr('data-mage-init',JSON.stringify({'equalHeight':{'target':' .product-item-info'}}));$(this).closest('.trigger-equal-height').trigger('contentUpdated');});}
if(this.options.isStickyLayout){var options={images:images,class:{sticky_gallery_content:'.gallery-sticky2',thumb_content:'.gallery-sticky2-image-thumb-col',image_content:'.gallery-sticky2-image-col',image_wrapper:'.gallery-sticky2-image-wrapper',video_wrapper:'.gallery-sticky2-video-wrapper'}};$.cleversoft.cleverBaseUpdateImageAndVideo(options);}
if(this.options.equalHeightConfig)this._updateHeightOnCatalogListing('#zoo-product-listing');}});$.widget('mage.cleverSwatchRendererProductDetails',$.mage.cleverSwatchRenderer,{_RenderControls:function(){var $widget=this,container=this.element,classes=this.options.classes,chooseText=this.options.jsonConfig.chooseText;$widget.optionsMap={};$.each(this.options.jsonConfig.attributes,function(){var item=this,options=$widget._RenderSwatchOptions(item),select=$widget._RenderSwatchSelect(item,chooseText),input=$widget._RenderFormInput(item),label='';if($widget.options.onlySwatches&&!$widget.options.jsonSwatchConfig.hasOwnProperty(item.id)){return;}
if($widget.options.enableControlLabel){label+='<span class="'+classes.attributeLabelClass+'">'+item.label+'</span>'+'<span class="'+classes.attributeSelectedOptionLabelClass+'"></span>';}
container.append('<div class="'+classes.attributeClass+' '+item.code+'" attribute-code="'+item.code+'" attribute-id="'+item.id+'">'+
label+'<div class="'+classes.attributeOptionsWrapper+' clearfix">'+
options+select+input+'</div>'+'</div>');$widget.optionsMap[item.id]={};$.each(item.options,function(){if(this.products.length>0){$widget.optionsMap[item.id][this.id]={price:parseInt($widget.options.jsonConfig.optionPrices[this.products[0]].finalPrice.amount,10),products:this.products};}});});container.find('[option-type="1"], [option-type="2"], [option-type="0"], [option-type="3"]').cleverSwatchRendererTooltip();$('.'+classes.moreButton).nextAll().hide();$widget._EventListener();$widget._Rewind(container);$widget._EmulateSelected($.parseQuery());$widget._EmulateSelected($widget._getSelectedAttributes());}});});